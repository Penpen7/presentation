---
title: テストメソッド名にこだわっている話
author: ネオ美魔
---

自己紹介
---

<!-- column_layout: [4, 3] -->
<!-- column: 0 -->
# 名前
Penpen7
# 職種
バックエンドエンジニア
# 好きな言語
Rust, Go
# 仕事
KINTO FACTORYの開発に携わっています
# コメント
今回はterminal上でスライドを作ってみました

<!-- column: 1 -->
![](me.png)
箱根旅行での私

<!-- end_slide -->
単体テストでのテストコード
---
<!-- column_layout: [1, 1] -->
<!-- column: 0 -->
# テスト対象のコード
```file +line_numbers {3-6}
path: ./src/main.go
language: go
```
<!-- column: 1 -->
# テストコード
```file +line_numbers {5-11}
path: ./src/main_test.go
language: go
```
<!-- reset_layout -->
# テスト実行
```bash +exec
/// go clean -testcache
/// cd src
go test ./... -v
```
<!-- end_slide -->
書いたコード
---
# ECサイトの在庫管理システムの仕様
- 商品が売れたら在庫数を減らす
- 在庫数が0の商品を購入できない
# 書いたコード
```go
// 在庫管理システム
type StockController struct {}

// 在庫数を更新する
func (c *StockController) KeepItem(itemID) error {}
```
# テストコード
```go
func Test_正常系_在庫数が0より大きい場合(t *testing.T) { }
func Test_在庫切れエラー(t *testing.T) { }
```
<!-- end_slide -->
どこが悪いのか？
---

# 在庫数が0より大きい場合、どういう結果を期待しているのかがわかりにくい
```go
func Test_正常系_在庫数が0より大きい場合(t *testing.T) { }
```
# どのような条件下でテストしているのかがわかりにくい
```go
func Test_在庫切れエラー(t *testing.T) { }
```

<!-- end_slide -->
どこが悪いのか？
---
`{ テスト対象メソッド }_{ 事前条件 }_{ 想定する結果 }`に変えてみる
# どういう結果を期待しているかわかりやすくなった
```diff
- func Test_正常系_在庫数が0より大きい場合(t *testing.T) { }
+ func Test_KeepItem_在庫数が0より大きい場合_正常終了(t *testing.T) { }
```
# どういう条件下でテストしているかわかりやすくなった
```diff
- func Test_在庫切れエラー(t *testing.T) { }
+ func Test_KeepItem_在庫数が0の場合_在庫切れエラー(t *testing.T) { }
```

でも、まだわかりにくい...
<!-- end_slide -->
さらに改善する
---
- テストケース名は非エンジニアでも読めるように書くべき
    - 実はメソッド名をテストケースに含めるのはアンチパターン
- テストメソッド名にWhatを書き、メソッドの中身にHowを書く

```diff
- func Test_KeepItem_在庫数が0より大きい場合_正常終了(t *testing.T) { }
+ func Test_商品の在庫数が0より大きい場合_商品を確保できる(t *testing.T) { }
```

```diff
- func Test_KeepItem_在庫数が0の場合_在庫切れエラー(t *testing.T) { }
+ func Test_商品在庫数が0の場合_商品を確保できない(t *testing.T) { }
```
<!-- end_slide -->

そもそもなんでテストするんだっけ？
---

- ソフトウェアを持続可能的に成長させるため
- 成長に合わせてコード・仕様が複雑化していくと、機能追加が難しくなりがち
- 最初の頃はテストを書かない方が早い

![image:width:50%](graph.png)
<!-- end_slide -->
じゃあ、テストをとにかく書けば良いということ？
---
# そうではない
- テストがあれば、最初のうちはコードの劣化を防ぐことができる
- しかし、質の悪いテストはやがてメンテナンスを困難にする
- 質の良いテストコードを書くことが大事
# テストメソッド名はテストコードの質を向上させるための手段の一つ
- テストメソッド名がわかりやすいと、テストコード全体の理解がしやすくなる
- 結局何をテストしているのかがわからず、テストコード全体を読む必要がある
  - テストコードの可読性が低いと地獄


<!-- column_layout: [1, 1] -->
<!-- column: 0 -->
![image:width:90%](graph.png)
<!-- column: 1 -->
![image:width:100%](./quality_test_graph.png)

<!-- end_slide -->
まとめ
---

- テストコードはソフトウェアを持続可能的に成長させるために書く
- 質の悪いテストコードは長期的にみて成長を阻害するため、質の良いテストコードを書くことが大事
- 質の良いテストコードを書く手段の一つとして理解しやすいテストメソッド名にこだわってみましょう
  - 可読性の高いテストコードを書くのは難しいので、まずはやりやすいところから始める
- テストメソッド名は非エンジニアでも理解できるように書いておくとなお良い
  - 将来の自分や他のエンジニアにとっても嬉しい
